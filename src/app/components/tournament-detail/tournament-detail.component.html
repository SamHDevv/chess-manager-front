<div class="tournament-detail-container">
  <!-- Loading State -->
  @if (loading()) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Cargando detalles del torneo...</p>
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <div class="error-state">
      <div class="error-icon">âš ï¸</div>
      <h3>Error al cargar el torneo</h3>
      <p>{{ error() }}</p>
      <button class="btn btn-primary" (click)="onBackToList()">
        Volver a la lista
      </button>
    </div>
  }

  <!-- Tournament Details -->
  @if (!loading() && !error() && tournament()) {
    <div class="tournament-header">
      <button class="back-button" (click)="onBackToList()">
        â† Volver a torneos
      </button>
      
      <div class="tournament-status-badge" [class]="getStatusClass(tournament()!.status)">
        {{ getStatusLabel(tournament()!.status) }}
      </div>
    </div>

    <div class="tournament-content">
      <!-- Main Tournament Info -->
      <div class="tournament-main-info">
        <div class="tournament-hero">
          <div class="tournament-image">
            <div class="placeholder-image">â™”</div>
          </div>
          
          <div class="tournament-info">
            <h1>{{ tournament()!.name }}</h1>
            
            @if (tournament()!.description) {
              <p class="tournament-description">{{ tournament()!.description }}</p>
            }
            
            <div class="tournament-details">
              <div class="detail-row">
                <div class="detail-item">
                  <span class="label">ğŸ“… Fecha de inicio:</span>
                  <span class="value">{{ formatDate(tournament()!.startDate) }}</span>
                </div>
                <div class="detail-item">
                  <span class="label">ğŸ Fecha de fin:</span>
                  <span class="value">{{ formatDate(tournament()!.endDate) }}</span>
                </div>
              </div>
              
              <div class="detail-row">
                <div class="detail-item">
                  <span class="label">ğŸ“ UbicaciÃ³n:</span>
                  <span class="value">{{ tournament()!.location }}</span>
                </div>
                @if (tournament()!.maxParticipants) {
                  <div class="detail-item">
                    <span class="label">ğŸ‘¥ Participantes:</span>
                    <span class="value">{{ participants().length }} / {{ tournament()!.maxParticipants }}</span>
                  </div>
                }
              </div>

              <div class="detail-row">
                <div class="detail-item">
                  <span class="label">ğŸ† Formato:</span>
                  <span class="value">{{ getTournamentFormatLabel(tournament()!.tournamentFormat) }}</span>
                </div>
              </div>

              @if (tournament()!.registrationDeadline) {
                <div class="detail-row">
                  <div class="detail-item">
                    <span class="label">â° LÃ­mite de inscripciÃ³n:</span>
                    <span class="value" [class.expired]="isRegistrationClosed()">
                      {{ tournament()!.registrationDeadline ? formatDate(tournament()!.registrationDeadline!) : 'No definido' }}
                    </span>
                  </div>
                </div>
              }
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="tournament-actions">
          @if (tournament()!.status === 'upcoming') {
            @if (!authService.isAuthenticated()) {
              <button class="btn btn-primary btn-large" (click)="onInscribe()">
                Iniciar sesiÃ³n para inscribirse
              </button>
              <div class="info-message">
                â„¹ï¸ Debes iniciar sesiÃ³n para inscribirte en este torneo
              </div>
            } @else if (canInscribe()) {
              @if (!userInscribed()) {
                <button 
                  class="btn btn-primary btn-large" 
                  (click)="onInscribe()"
                  [disabled]="inscriptionLoading()">
                  @if (inscriptionLoading()) {
                    <span class="spinner-small"></span>
                  }
                  Inscribirse en el torneo
                </button>
                
                @if (spotsLeft() !== null && spotsLeft()! <= 5) {
                  <div class="spots-warning">
                    âš ï¸ Solo quedan {{ spotsLeft() }} plazas disponibles
                  </div>
                }
              } @else {
                <button 
                  class="btn btn-danger btn-large" 
                  (click)="onCancelInscription()"
                  [disabled]="inscriptionLoading()">
                  @if (inscriptionLoading()) {
                    <span class="spinner-small"></span>
                  }
                  Cancelar inscripciÃ³n
                </button>
                <div class="success-message">
                  âœ… EstÃ¡s inscrito en este torneo
                </div>
              }
            } @else {
              @if (isRegistrationClosed()) {
                <div class="info-message">
                  â° El perÃ­odo de inscripciÃ³n ha cerrado
                </div>
              } @else if (tournament()!.maxParticipants && participants().length >= tournament()!.maxParticipants!) {
                <div class="info-message">
                  ğŸ‘¥ El torneo ha alcanzado el mÃ¡ximo de participantes
                </div>
              } @else {
                <div class="info-message">
                  â„¹ï¸ No es posible inscribirse en este momento
                </div>
              }
            }
          }
        </div>

        <!-- Organizer/Admin Actions -->
        @if (canEdit() || canDelete() || canStartTournament() || canFinishTournament()) {
          <div class="organizer-actions">
            <h3>GestiÃ³n del torneo</h3>
            
            <!-- Tournament State Control Buttons -->
            @if (canStartTournament() || canFinishTournament()) {
              <div class="state-control-buttons">
                @if (canStartTournament()) {
                  <button 
                    class="btn btn-start" 
                    (click)="startTournament()"
                    [disabled]="loading()">
                    ğŸ Iniciar torneo ahora
                  </button>
                }
                
                @if (canFinishTournament()) {
                  <button 
                    class="btn btn-finish" 
                    (click)="finishTournament()"
                    [disabled]="loading()">
                    ğŸ† Finalizar torneo ahora
                  </button>
                }
              </div>
            }
            
            <!-- Edit/Delete Buttons -->
            <div class="organizer-buttons">
              @if (canEdit()) {
                <button 
                  class="btn btn-secondary" 
                  (click)="onEditTournament()">
                  âœï¸ Editar torneo
                </button>
              }
              
              @if (canDelete()) {
                <button 
                  class="btn btn-danger" 
                  (click)="onDeleteTournament()">
                  ğŸ—‘ï¸ Eliminar torneo
                </button>
              }
            </div>
            
            @if (isOrganizer()) {
              <div class="organizer-badge">
                ğŸ‘‘ Eres el organizador de este torneo
              </div>
            } @else if (isAdmin()) {
              <div class="admin-badge">
                ğŸ›¡ï¸ GestiÃ³n como administrador
              </div>
            }
          </div>
        }

        <!-- Tournament Navigation -->
        @if (tournament()!.status !== 'upcoming') {
          <div class="tournament-navigation">
            <h3>Explorar torneo</h3>
            <div class="navigation-buttons">
              <button 
                class="btn btn-outline" 
                (click)="onViewMatches()">
                âš”ï¸ {{ canManageMatches() ? 'Ver partidas y registrar resultados' : 'Ver partidas' }}
              </button>
              <button 
                class="btn btn-outline" 
                (click)="onViewRanking()">
                ğŸ“Š Ver clasificaciÃ³n
              </button>
            </div>
          </div>
        }
      </div>

      <!-- Sidebar with participants -->
      <div class="tournament-sidebar">
        <div class="participants-section">
          <h3>Participantes ({{ participants().length }})</h3>
          
          @if (participants().length > 0) {
            <div class="participants-list">
              @for (participant of participants(); track participant.id) {
                <div class="participant-card">
                  <div class="participant-avatar">
                    {{ participant.name.charAt(0).toUpperCase() }}
                  </div>
                  <div class="participant-info">
                    <span class="participant-name">{{ participant.name }}</span>
                    @if (participant.elo) {
                      <span class="participant-elo">ELO: {{ participant.elo }}</span>
                    } @else {
                      <span class="participant-elo">Sin rating</span>
                    }
                  </div>
                </div>
              }
            </div>
          } @else {
            <div class="empty-participants">
              <div class="empty-icon">ğŸ‘¥</div>
              <p>AÃºn no hay participantes inscritos</p>
              @if (tournament()!.status === 'upcoming') {
                <p class="empty-subtitle">Â¡SÃ© el primero en inscribirte!</p>
              }
            </div>
          }

          @if (tournament()!.maxParticipants) {
            <div class="capacity-indicator">
              <div class="capacity-bar">
                <div 
                  class="capacity-fill" 
                  [style.width.%]="(participants().length / tournament()!.maxParticipants!) * 100">
                </div>
              </div>
              <span class="capacity-text">
                {{ participants().length }} / {{ tournament()!.maxParticipants }} participantes
              </span>
            </div>
          }
        </div>

        @if (tournament()!.status !== 'upcoming') {
          <div class="tournament-info-section">
            <h3>InformaciÃ³n del torneo</h3>
            <div class="info-stats">
              @if (tournament()!.status === 'ongoing') {
                <div class="stat-item">
                  <span class="stat-label">Estado:</span>
                  <span class="stat-value ongoing">En progreso</span>
                </div>
              }
              
              @if (tournament()!.status === 'finished') {
                <div class="stat-item">
                  <span class="stat-label">Estado:</span>
                  <span class="stat-value finished">Finalizado</span>
                </div>
              }
            </div>
          </div>
        }
      </div>
    </div>
  }
</div>
<div class="tournament-create">
  <div class="container">
    <!-- Header -->
    <div class="page-header">
      <button type="button" class="back-btn" (click)="goBack()">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <path d="M19 12H5M12 19L5 12L12 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Volver
      </button>
      <div class="header-content">
        <h1 class="page-title">Crear Nuevo Torneo</h1>
        <p class="page-subtitle">Organiza tu propio torneo de ajedrez</p>
      </div>
    </div>

    <!-- Success Message -->
    @if (success()) {
      <div class="success-message">
        <div class="success-content">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M22 11.08V12A10 10 0 1 1 5.93 7.85" stroke="#10b981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M22 4L12 14.01L9 11.01" stroke="#10b981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <div>
            <h3>¡Torneo creado exitosamente!</h3>
            <p>Serás redirigido al detalle del torneo en unos segundos...</p>
          </div>
        </div>
      </div>
    }

    <!-- Error Message -->
    @if (error()) {
      <div class="error-message">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
          <circle cx="12" cy="12" r="10" stroke="#ef4444" stroke-width="2"/>
          <line x1="15" y1="9" x2="9" y2="15" stroke="#ef4444" stroke-width="2"/>
          <line x1="9" y1="9" x2="15" y2="15" stroke="#ef4444" stroke-width="2"/>
        </svg>
        <span>{{ error() }}</span>
      </div>
    }

    <!-- Tournament Form -->
    @if (!success()) {
      <form [formGroup]="tournamentForm" (ngSubmit)="createTournament()" class="tournament-form">
        <!-- Basic Information Section -->
        <div class="form-section">
          <h2 class="section-title">Información Básica</h2>
          
          <!-- Tournament Name -->
          <div class="form-group">
            <label for="name" class="form-label">
              Nombre del Torneo *
            </label>
            <input
              id="name"
              type="text"
              formControlName="name"
              class="form-control"
              [class.error]="nameControl?.invalid && nameControl?.touched"
              placeholder="Ej: Campeonato de Ajedrez 2024"
              maxlength="100"
            />
            @if (nameControl?.invalid && nameControl?.touched) {
              <div class="error-text">
                @if (nameControl?.errors?.['required']) {
                  El nombre del torneo es requerido
                }
                @if (nameControl?.errors?.['minlength']) {
                  El nombre debe tener al menos 3 caracteres
                }
                @if (nameControl?.errors?.['maxlength']) {
                  El nombre no puede exceder los 100 caracteres
                }
              </div>
            }
          </div>

          <!-- Description -->
          <div class="form-group">
            <label for="description" class="form-label">
              Descripción
            </label>
            <textarea
              id="description"
              formControlName="description"
              class="form-control textarea"
              [class.error]="descriptionControl?.invalid && descriptionControl?.touched"
              placeholder="Describe tu torneo, reglas especiales, premios, etc."
              rows="4"
              maxlength="500"
            ></textarea>
            <div class="char-counter">
              {{ descriptionControl?.value?.length || 0 }}/500 caracteres
            </div>
            @if (descriptionControl?.invalid && descriptionControl?.touched) {
              <div class="error-text">
                @if (descriptionControl?.errors?.['maxlength']) {
                  La descripción no puede exceder los 500 caracteres
                }
              </div>
            }
          </div>

          <!-- Location -->
          <div class="form-group">
            <label for="location" class="form-label">
              Ubicación *
            </label>
            <input
              id="location"
              type="text"
              formControlName="location"
              class="form-control"
              [class.error]="locationControl?.invalid && locationControl?.touched"
              placeholder="Ej: Club de Ajedrez Madrid, Madrid, España"
              maxlength="200"
            />
            @if (locationControl?.invalid && locationControl?.touched) {
              <div class="error-text">
                @if (locationControl?.errors?.['required']) {
                  La ubicación es requerida
                }
                @if (locationControl?.errors?.['minlength']) {
                  La ubicación debe tener al menos 3 caracteres
                }
                @if (locationControl?.errors?.['maxlength']) {
                  La ubicación no puede exceder los 200 caracteres
                }
              </div>
            }
          </div>
        </div>

        <!-- Dates and Configuration Section -->
        <div class="form-section">
          <h2 class="section-title">Fechas y Configuración</h2>
          
          <!-- Dates Row -->
          <div class="form-row">
            <!-- Start Date -->
            <div class="form-group">
              <label for="startDate" class="form-label">
                Fecha de Inicio *
              </label>
              <input
                id="startDate"
                type="date"
                formControlName="startDate"
                class="form-control"
                [class.error]="startDateControl?.invalid && startDateControl?.touched"
              />
              @if (startDateControl?.invalid && startDateControl?.touched) {
                <div class="error-text">
                  La fecha de inicio es requerida
                </div>
              }
            </div>

            <!-- End Date -->
            <div class="form-group">
              <label for="endDate" class="form-label">
                Fecha de Fin *
              </label>
              <input
                id="endDate"
                type="date"
                formControlName="endDate"
                class="form-control"
                [class.error]="endDateControl?.invalid && endDateControl?.touched"
              />
              @if (endDateControl?.invalid && endDateControl?.touched) {
                <div class="error-text">
                  La fecha de fin es requerida
                </div>
              }
            </div>
          </div>

          <!-- Registration Deadline -->
          <div class="form-group">
            <label for="registrationDeadline" class="form-label">
              Fecha Límite de Inscripción *
            </label>
            <input
              id="registrationDeadline"
              type="date"
              formControlName="registrationDeadline"
              class="form-control"
              [class.error]="registrationDeadlineControl?.invalid && registrationDeadlineControl?.touched"
            />
            @if (registrationDeadlineControl?.invalid && registrationDeadlineControl?.touched) {
              <div class="error-text">
                La fecha límite de inscripción es requerida
              </div>
            }
          </div>

          <!-- Date Validation Errors -->
          @if (hasDateError()) {
            <div class="error-message">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <circle cx="12" cy="12" r="10" stroke="#ef4444" stroke-width="2"/>
                <line x1="15" y1="9" x2="9" y2="15" stroke="#ef4444" stroke-width="2"/>
                <line x1="9" y1="9" x2="15" y2="15" stroke="#ef4444" stroke-width="2"/>
              </svg>
              <span>{{ getDateErrorMessage() }}</span>
            </div>
          }

          <!-- Configuration Row -->
          <div class="form-row">
            <!-- Max Participants -->
            <div class="form-group">
              <label for="maxParticipants" class="form-label">
                Máximo de Participantes *
              </label>
              <input
                id="maxParticipants"
                type="number"
                formControlName="maxParticipants"
                class="form-control"
                [class.error]="maxParticipantsControl?.invalid && maxParticipantsControl?.touched"
                min="4"
                max="128"
                step="1"
              />
              @if (maxParticipantsControl?.invalid && maxParticipantsControl?.touched) {
                <div class="error-text">
                  @if (maxParticipantsControl?.errors?.['required']) {
                    El número de participantes es requerido
                  }
                  @if (maxParticipantsControl?.errors?.['min']) {
                    Mínimo 4 participantes
                  }
                  @if (maxParticipantsControl?.errors?.['max']) {
                    Máximo 128 participantes
                  }
                </div>
              }
            </div>

            <!-- Status -->
            <div class="form-group">
              <label for="status" class="form-label">
                Estado Inicial *
              </label>
              <select
                id="status"
                formControlName="status"
                class="form-control"
              >
                @for (status of tournamentStatuses; track status.value) {
                  <option [value]="status.value">{{ status.label }}</option>
                }
              </select>
            </div>
          </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button
            type="button"
            class="btn btn-secondary"
            (click)="goBack()"
            [disabled]="isLoading()"
          >
            Cancelar
          </button>
          
          <button
            type="button"
            class="btn btn-outline"
            (click)="resetForm()"
            [disabled]="isLoading()"
          >
            Limpiar
          </button>
          
          <button
            type="submit"
            class="btn btn-primary"
            [disabled]="tournamentForm.invalid || isLoading()"
          >
            @if (isLoading()) {
              <svg class="loading-spinner" width="20" height="20" viewBox="0 0 24 24" fill="none">
                <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" opacity="0.25"/>
                <path d="M4 12a8 8 0 0 1 8-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 0 1 4 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" fill="currentColor"/>
              </svg>
              Creando...
            } @else {
              Crear Torneo
            }
          </button>
        </div>
      </form>
    }
  </div>
</div>
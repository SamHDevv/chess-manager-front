<div class="tournament-matches">
  <div class="container">
    <!-- Header -->
    <div class="page-header">
      <div class="header-top">
        <button class="back-button" (click)="onBackToTournament()">
          ← Volver al torneo
        </button>
        @if (isOrganizer()) {
          <div class="organizer-badge">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
              <path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z" stroke="currentColor" stroke-width="2"/>
              <path d="M9 12l2 2 4-4" stroke="currentColor" stroke-width="2"/>
            </svg>
            {{ authService.isAdmin() ? 'Administrador' : 'Organizador' }}
          </div>
        }
      </div>
      <div class="header-content">
        <div class="header-text">
          <h1>Vista de Partidas del Torneo</h1>
          <p>Visualiza los emparejamientos y resultados de cada ronda. El sistema suizo asegura que cada jugador se enfrente a oponentes con una puntuación similar.</p>
        </div>
        <div class="header-actions">
          <button class="btn-view-ranking" (click)="onViewRanking()">
            Ver clasificación
          </button>
        </div>
      </div>
    </div>

    @if (loading()) {
      <div class="loading-state">
        <div class="loading-content">
          <div class="spinner"></div>
          <p>Cargando partidas...</p>
        </div>
      </div>
    } @else if (error()) {
      <div class="error-state">
        <div class="error-content">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
            <circle cx="12" cy="12" r="10" stroke="#ef4444" stroke-width="2"/>
            <line x1="15" y1="9" x2="9" y2="15" stroke="#ef4444" stroke-width="2"/>
            <line x1="9" y1="9" x2="15" y2="15" stroke="#ef4444" stroke-width="2"/>
          </svg>
          <h3>Error al cargar las partidas</h3>
          <p>{{ error() }}</p>
        </div>
      </div>
    } @else {
      <!-- No matches - Show generate button -->
      @if (roundsData().length === 0 && isOrganizer()) {
        <div class="empty-state">
          <div class="empty-content">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none">
              <path d="M9 2H4a2 2 0 0 0-2 2v5m0 10a2 2 0 0 0 2 2h5M22 9V4a2 2 0 0 0-2-2h-5m10 10a2 2 0 0 1-2 2h-5" 
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <h3>No hay partidas disponibles</h3>
            <p>Este torneo aún no tiene partidas programadas.</p>
            <button class="btn-generate-matches" (click)="onGenerateMatches()">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
              Generar Partidas
            </button>
          </div>
        </div>
      } @else if (roundsData().length === 0) {
        <div class="empty-state">
          <div class="empty-content">
            <svg width="64" height="64" viewBox="0 0 24 24" fill="none">
              <path d="M9 2H4a2 2 0 0 0-2 2v5m0 10a2 2 0 0 0 2 2h5M22 9V4a2 2 0 0 0-2-2h-5m10 10a2 2 0 0 1-2 2h-5" 
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <h3>No hay partidas disponibles</h3>
            <p>Este torneo aún no tiene partidas programadas.</p>
          </div>
        </div>
      }
      
      <!-- Rounds Display -->
      <div class="rounds-container">
        @if (roundsData().length > 0) {
          @for (roundData of roundsData(); track roundData.roundNumber) {
            <div class="round-section">
              <div class="round-header">
                <h2 class="round-title">Ronda {{ roundData.roundNumber }}</h2>
              </div>
              
              <div class="matches-table">
                <div class="table-header">
                  <div class="header-cell mesa">Mesa</div>
                  <div class="header-cell jugador-blancas">Jugador Blancas</div>
                  <div class="header-cell jugador-negras">Jugador Negras</div>
                  <div class="header-cell resultado">Resultado</div>
                  <div class="header-cell estado">Estado</div>
                </div>
                
                @for (match of roundData.matches; track match.id) {
                  <div class="table-row">
                    <div class="cell mesa">{{ match.table }}</div>
                    
                    <div class="cell jugador-blancas">
                      <div class="player-info">
                        <span class="player-name">{{ match.player1Name }}</span>
                        @if (match.player1Rating) {
                          <span class="player-rating">({{ match.player1Rating }})</span>
                        }
                      </div>
                    </div>
                    
                    <div class="cell jugador-negras">
                      <div class="player-info">
                        <span class="player-name">{{ match.player2Name }}</span>
                        @if (match.player2Rating) {
                          <span class="player-rating">({{ match.player2Rating }})</span>
                        }
                      </div>
                    </div>
                    
                    <div class="cell resultado">
                      @if (isOrganizer() && canEditMatch(match)) {
                        <select 
                          [value]="match.result || ''" 
                          (change)="onResultChange($event, match)"
                          class="result-select"
                          [disabled]="savingResult()"
                        >
                          <option value="">-</option>
                          <option value="1-0">1-0</option>
                          <option value="0-1">0-1</option>
                          <option value="½-½">½-½</option>
                        </select>
                      } @else {
                        <span class="result-display">{{ getResultDisplay(match.result) }}</span>
                      }
                    </div>
                    
                    <div class="cell estado">
                      <span class="status-badge" [ngClass]="getStatusClass(match.status)">
                        {{ getStatusText(match.status) }}
                      </span>
                    </div>
                  </div>
                }
              </div>
            </div>
          }
          
          <!-- Generate Next Round Button - Diseño mejorado -->
          @if (isOrganizer() && canGenerateNextRound()) {
            <div class="next-round-section">
              <div class="completion-badge">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                  <circle cx="12" cy="12" r="10" stroke="#10b981" stroke-width="2"/>
                  <path d="M9 12l2 2 4-4" stroke="#10b981" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>Ronda {{ getCurrentRoundNumber() }} completada</span>
              </div>
              
              <button class="btn-generate-next-round" (click)="onGenerateMatches()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
                  <path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                Generar Ronda {{ getNextRoundNumber() }}
              </button>
              
              <p class="round-info">
                Todos los resultados han sido registrados. Haz clic para generar la siguiente ronda del torneo.
              </p>
            </div>
          } @else if (isOrganizer() && roundsData().length > 0 && !allResultsComplete()) {
            <div class="pending-results-message">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <circle cx="12" cy="12" r="10" stroke="#f59e0b" stroke-width="2"/>
                <path d="M12 8v4M12 16h.01" stroke="#f59e0b" stroke-width="2" stroke-linecap="round"/>
              </svg>
              <p>Completa todos los resultados de la Ronda {{ getCurrentRoundNumber() }} antes de generar la siguiente ronda</p>
            </div>
          }
        } @else {
          <div class="empty-state">
            <div class="empty-content">
              <svg width="64" height="64" viewBox="0 0 24 24" fill="none">
                <path d="M9 11H15M9 15H15M17 21H7C6.46957 21 5.96086 20.7893 5.58579 20.4142C5.21071 20.0391 5 19.5304 5 19V5C5 4.46957 5.21071 3.96086 5.58579 3.58579C5.96086 3.21071 6.46957 3 7 3H12.586C12.8512 3.00006 13.1055 3.10545 13.293 3.293L18.707 8.707C18.8946 8.89449 18.9999 9.14881 19 9.414V19C19 19.5304 18.7893 20.0391 18.4142 20.4142C18.0391 20.7893 17.5304 21 17 21Z" stroke="#9ca3af" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              <h3>No hay partidas disponibles</h3>
              <p>Este torneo aún no tiene partidas programadas.</p>
            </div>
          </div>
        }
      </div>
    }
  </div>
</div>